CREATE DATABASE PROJECTDATABASE;
USE PROJECTDATABASE;
DROP TABLE IF EXISTS SALES;
DROP TABLE IF EXISTS ORDERS;
DROP TABLE IF EXISTS DONUTS;
DROP TABLE IF EXISTS MAIL_ADDRESS;
DROP TABLE IF EXISTS CUSTOMER;

#CREATE TABLES OBJECTS
CREATE TABLE CUSTOMER (
    CUSTOMER_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
    FNAME VARCHAR(15) NOT NULL,
    LNAME VARCHAR(25) NOT NULL,
    HPHONE INT(10),
    MPHONE INT(10),
    OTHERPHONE INT(10));
CREATE TABLE MAIL_ADDRESS(
    CUSTOMER_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
    STREET VARCHAR (25) NOT NULL,
    APT TINYINT,
    CITY VARCHAR (100) NOT NULL,
    STATE VARCHAR(2) NOT NULL,
    ZIP INTEGER(10) NOT NULL,
    FOREIGN KEY(CUSTOMER_ID) REFERENCES CUSTOMER (CUSTOMER_ID)
);
CREATE TABLE DONUTS(
    DONUT_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
	DNAME VARCHAR(20) NOT NULL,
    DONUT_DESCRIPT VARCHAR(255) NOT NULL,
    DONUT_PRICE DEC(2,3) NOT NULL);
  CREATE TABLE ORDERS (
	ORDER_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
    ORDERDATE datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CUSTOMER_ID INTEGER NOT NULL,
    SPECIAL_NOTES VARCHAR(255),
    FOREIGN KEY(CUSTOMER_ID) REFERENCES CUSTOMER (CUSTOMER_ID)
 );
 CREATE TABLE SALES(
    ORDER_ID INTEGER,
    DONUT_ID INTEGER,
    QUANTITY INTEGER NOT NULL,
    PRIMARY KEY (ORDER_ID, DONUT_ID),
    FOREIGN KEY (DONUT_ID) REFERENCES DONUTS (DONUT_ID),
    FOREIGN KEY(ORDER_ID) REFERENCES ORDERS (ORDER_ID)
 );
 #POPULATE TABELS
INSERT INTO CUSTOMER(CUSTOMER_ID, FNAME, LNAME, HPHONE)
VALUES(1, "Walter", "Smith", 809-603-9283);
INSERT INTO MAIL_ADDRESS(CUSTOMER_ID, STREET, APT, CITY, STATE, ZIP)
VALUES(1, "1250 Newton", 35, "Seattle", "WA", 98102);
INSERT INTO DONUTS(DONUT_ID, DNAME, DONUT_DESCRIPT, DONUT_PRICE)
VALUES(1, "Plane", "Plain Donut", 1.50),
(2, "Glazed", "Glazed Donut", 1.75),
(3, "Cinnamon", "Cinnamon Donut", 1.75),
(4, "Chocolate", "Chocolate Donut", 1.75),
(5, "Sprinkle", "Sprinkle Donut", 1.75),
(6, "Gluten-Free", "Gluten-free Donut", 2.00);
INSERT INTO ORDERS(ORDER_ID, CUSTOMER_ID, SPECIAL_NOTES)
VALUE(1, 1, "Please include plates and napkins.");
INSERT INTO SALES(ORDER_ID, DONUT_ID, QUANTITY)
VALUES(1, 1,1),
(1, 2, 5),
(1, 3, 12),
(1, 4, 3),
(1, 5, 4),
(1, 6, 5);
#TEST DATABASE OBJECTS
SELECT * FROM CUSTOMER;
SELECT * FROM DONUTS;
SELECT * FROM ORDERS;
SELECT * FROM SALES;
#COMPLEX SELECT QURRY
SELECT SPECIAL_NOTES, CUSTOMER_ID FROM ORDERS WHERE ORDER_ID = 1;
SELECT CUSTOMER.CUSTOMER_ID, ORDERS.ORDER_ID, ORDERS.ORDERDATE, SALES.DONUT_ID, QUANTITY FROM SALES
JOIN ORDERS ON SALES.ORDER_ID = ORDERS.ORDER_ID JOIN  CUSTOMER ON ORDERS.CUSTOMER_ID=CUSTOMER.CUSTOMER_ID;
SELECT DNAME, DONUT_DESCRIPT, DONUT_PRICE FROM DONUTS WHERE DONUT_PRICE >= 1.75;
#INDEX
CREATE INDEX Donut_Inof ON DONUTS(DNAME);
#VIEW
drop if exists invoice;
CREATE VIEW INVOICE AS
SELECT CUSTOMER.CUSTOMER_ID, CONCAT(CUSTOMER.FNAME," ",CUSTOMER.LNAME) AS COSTOMER_NAME, 
CUSTOMER.HPHONE, MAIL_ADDRESS.STREET, MAIL_ADDRESS.APT, MAIL_ADDRESS.CITY, MAIL_ADDRESS.ZIP, 
ORDERS.ORDER_ID, SALES.DONUT_ID, DONUTS.DNAME, DONUTS.DONUT_DESCRIPT, DONUTS.DONUT_PRICE 
FROM CUSTOMER JOIN MAIL_ADDRESS ON CUSTOMER.CUSTOMER_ID = MAIL_ADDRESS.CUSTOMER_ID 
JOIN ORDERS ON MAIL_ADDRESS.CUSTOMER_ID = ORDERS.CUSTOMER_ID 
JOIN SALES ON ORDERS.ORDER_ID = SALES.ORDER_ID 
RIGHT JOIN DONUTS ON SALES.DONUT_ID = DONUTS.DONUT_ID;